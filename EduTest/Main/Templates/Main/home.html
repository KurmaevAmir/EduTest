{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduTest</title>
    <link rel="stylesheet" href="{% static 'Main/styles.css' %}">
    <link rel="shortcut icon" href="{% static 'Main/mini-icon.png' %}" type="image/x-icon">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>

<div class="header">
    <div class="container">
        <div class="logo-title">
            <img src="{% static 'Main/header.png' %}" alt="Лого" class="header-logo">
            <a href={% url 'Main:home' %}>
                <span class="header-text" style="color: #fff">EduTest</span>
            </a>
        </div>
        <div id="userLinks" class="user-links">
            <!-- Ссылки для пользователя будут добавлены здесь с помощью JavaScript -->
        </div>
        <div id="userProfile">
            <button id="loginButton" class="btn btn-outline-light btn-sm">Вход</button>
            <img id="userAvatar" src="{% static 'Main/profileIcon-image.png' %}" alt="User Avatar" class="user-avatar">
        </div>
    </div>
</div>

<div class="info-layer" id="infoLayer">
    <div class="info-text">
        <h2>Добро пожаловать!</h2>
        <p>Мы рады предоставить студентам и преподавателям удобные и эффективные инструменты для онлайн тестирования</p>
        <button id="learnMoreButton" class="btn btn-outline-primary">Узнать больше</button>
    </div>
</div>

<div class="content">
    <img src="{% static 'Main/girlSiting-image.png' %}" alt="Center Image" class="content-image">
    <div class="about" id="about">
        <h2>О нас</h2>
        <p>EduTest - это образовательный проект, предоставляющий студентам и преподавателям удобные и эффективные
            инструменты для онлайн тестирования. Наша платформа предлагает простой и интуитивно понятный интерфейс,
            который позволяет преподавателям создавать свои тесты, а студентам - проходить их.</p>
        <h3>Наши преимущества</h3>
        <ul>
            <li>Интуитивно понятный интерфейс</li>
            <li>Удобные инструменты для создания тестов</li>
            <li>Эффективная система управления тестированием</li>
            <li>Возможность анализировать результаты</li>
        </ul>
        <p>Присоединяйтесь к нам, чтобы сделать процесс тестирования проще и удобнее.</p>
    </div>
</div>

<div class="footer" id="footer">
    <h6>2024 OOO "EduTest"</h6>
</div>

<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Авторизация</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                    <form method="post">
                        {% csrf_token %}
                        {% for field in form %}
                            <div class="form-group">
                                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                                <input type="{{ field.field.widget.input_type }}" name="{{ field.name }}" id="{{ field.id_for_label }}" class="form-control" required>
                            </div>
                        {% endfor %}
                        <button type="submit" class="btn-primary">Авторизоваться</button>
                    </form>
                    {% if form.errors %}
                        <ul class="errorlist">
                            {% for field in form %}
                                {% for error in field.errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            {% endfor %}
                            {% for error in form.non_field_errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                <div class="text-center mt-3">
                    <p>Нет аккаунта? <a href='{% url 'Main:registration' %}' id="registerLink">Создать</a></p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        const testsUrl = '#';
        const constructorUrl = '{% url "constructor:test_create" %}';

        // Открытие модального окна авторизации
        $('#loginButton').click(function () {
            $('#loginModal').modal('show');
        });

        // Закрытие модального окна авторизации
        $('#loginModal').on('hidden.bs.modal', function () {
            $(this).find('form')[0].reset(); // Сброс формы
        });



        document.getElementById('learnMoreButton').addEventListener('click', function () {
            document.getElementById('about').scrollIntoView({behavior: 'smooth'}); // Прокрутка до раздела "О нас"
        });

        $('#userLinks').on('click', '#testsLink', function (event) {
            event.preventDefault();
            window.location.href = testsUrl;
        });

        $('#userLinks').on('click', '#constructorLink', function (event) {
            event.preventDefault();
            window.location.href = constructorUrl;
        });

        function fetchUserDataAndSetLinks() {
            // Получение данных от Django-бэкенда
            const userAuthorized = {{ user_authorized|yesno:"true,false" }};
            const userAccessLevel = {{ access }};

            const userLinks = document.getElementById('userLinks');
            userLinks.innerHTML = '';

            // Устанавливаем ссылки в зависимости от уровня доступа
            if (userAccessLevel >= 1) {
                const testsLink = document.createElement('a');
                testsLink.href = '#';
                testsLink.id = 'testsLink';
                testsLink.innerText = 'Тесты';
                testsLink.style.display = 'inline-block';
                userLinks.appendChild(testsLink);
            }

            if (userAccessLevel >= 2) {
                const constructorLink = document.createElement('a');
                constructorLink.href = '#';
                constructorLink.id = 'constructorLink';
                constructorLink.innerText = 'Конструктор';
                constructorLink.classList.add('constructor-link');
                constructorLink.style.display = 'inline-block';
                userLinks.appendChild(constructorLink);
            }

            const loginButton = document.getElementById('loginButton');
            const userAvatar = document.getElementById('userAvatar');
            if (userAuthorized) {
                loginButton.style.display = 'none';
                userAvatar.style.display = 'inline-block';
            } else {
                loginButton.style.display = 'inline-block';
                userAvatar.style.display = 'none';
            }
        }

        fetchUserDataAndSetLinks();
    });

</script>
</body>
</html>